---
title: Reverse engineering avec Frida et Burp
date: 2024-08-15
image: ./frida.png
imageAlt: Frida
---

Cet article assez court explique pas √† pas comment bypasser le SSL pinning lors de l'analyse d'une application Android avec Frida et Burp.

Je vous invite √† lire [mon article sur PixPay](http://localhost:8000/reverse-eng-pixpay/) pour un peu plus de d√©tail sur ce qu'est le reverse engineering.

## Pr√©requis

* Python 3.11 ou plus
* Burp Suite (CE suffit)
* Les Android Platform Tools (pour utiliser l'outil `adb`)
* Un Android root√©
* Un cable pour connecter votre t√©l√©phone √† votre ordinateur

## Installer Frida

![frida_logo](./frida_logo.png)

Commencez par cr√©er un environnement virtuel et installez Frida.

### üíª Sur votre ordinateur 

#### Cr√©er un environnement virtuel

```
python3 -m venv frida
source frida/bin/activate
```

#### Installer Frida

```
pip install Frida
pip install objection
pip install frida-tools
```

### üì± Sur votre Android 

Maintenant, installons Frida sur votre t√©l√©phone. Assurez-vous que le d√©bogage USB est activ√© puis branchez votre t√©l√©phone √† votre ordinateur.

#### T√©l√©charger Frida Server

Ex√©cutez cette commande sur votre ordinateur pour obtenir l'architecture de votre t√©l√©phone.

```
adb shell getprop ro.product.cpu.abi
```

Cliquez sur [ce lien](https://github.com/frida/frida/releases), et s√©lectionnez la version de **Frida Server** (et non pas Platform Kit !) correspondant √† votre architecture.

#### D√©compresser et renommer le fichier

Remplacez `VERSION` et `ARCH` par les valeurs que vous avez obtenues pr√©c√©demment.

```
xz --decompress frida-server-VERSION-android-ARCH.xz

mv frida-server-VERSION-android-ARCH frida-server
```

#### Uploader le fichier sur votre t√©l√©phone

Les commandes suivantes permettent de copier le fichier sur votre t√©l√©phone et de le rendre ex√©cutable.

```
adb push frida-server /data/local/tmp/
adb shell "chmod 777 /data/local/tmp/frida-server"
```

#### Ex√©cuter Frida Server

```
adb shell
su
/data/local/tmp/frida-server &
```

![magisk](./magisk.jpg)

> Attention √† bien accorder les permisssions root au Shell pour ex√©cuter Frida Server.

Et voil√† !

Maintenant, sur votre ordinateur, lancez la commande suivante :

```
frida --codeshare akabe1/frida-multiple-unpinning -U -f com.yourapp.package
```

Remplacez `com.yourapp.package` par le package de l'application que vous souhaitez analyser.

## Suite Burp

Lancez la suite Burp et dirigez-vous vers l'onglet `Proxy`.

### Installer le certificat Burp

Dans un premier temps, il vous faut exporter le certificat Burp. Pour cela, rendez-vous dans `Proxy` > `Options` > `Import / Export CA Certificate`.

S√©lectionnez le format `DER` et exportez le certificat (en prenant garde d'ajouter manuellement l'extension `.der` !). T√©l√©chargez-le sur votre t√©l√©phone, et depuis les param√®tres, installez-le.

#### Faire confiance au certificat 

Avec un explorateur root comme [MiXplorer](https://mixplorer.com), rendez-vous dans un de ces deux dossiers :
* `/data/misc/keychain/cacerts-added/`
* (ou, si le premier dossier est vide) `/data/misc/user/0/cacerts-added/`

D√©placez le fichier que vous avez trouv√© dans un des deux dossiers vers `/system/etc/security/cacerts`.

Red√©marrez votre t√©l√©phone.

### Configurer le proxy sur Burp et Android

Pour que votre t√©l√©phone utilise Burp comme proxy, rendez-vous dans les param√®tres de votre t√©l√©phone, puis dans `R√©seau et Internet` > `Wi-Fi` > `Modifier le r√©seau` > `Avanc√©`.

Obtenez l'IP locale de votre ordinateur avec la commande `ip a` par exemple, et entrez-la dans le champ `Proxy`.

En tant que port, utilisez `8888`.

![burp_proxy](./burp_proxy.png)

Puis rendez-vous dans Burp, et ajoutez une `Bind Address` dans les param√®tres de proxy (`*:8888`, s√©lectionnez `All interfaces`).

Et voil√† !

Vous devriez voir les requ√™tes en clair arriver dans Burp (si ce n'est pas le cas, assurez-vous que l'interception est bien activ√©e).

![burp](./burp.png)
